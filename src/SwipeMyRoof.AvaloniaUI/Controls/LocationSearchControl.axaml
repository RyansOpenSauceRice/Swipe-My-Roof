<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="SwipeMyRoof.AvaloniaUI.Controls.LocationSearchControl">

    <UserControl.Styles>
        <Style Selector="TextBox.search-box">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Padding" Value="15 10"/>
            <Setter Property="Margin" Value="0 0 0 10"/>
            <Setter Property="CornerRadius" Value="5"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>
        
        <Style Selector="ListBox.suggestions">
            <Setter Property="MaxHeight" Value="200"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#CCCCCC"/>
            <Setter Property="CornerRadius" Value="5"/>
            <Setter Property="Background" Value="White"/>
        </Style>
        
        <Style Selector="Slider.radius-slider">
            <Setter Property="Minimum" Value="100"/>
            <Setter Property="Maximum" Value="10000"/>
            <Setter Property="Value" Value="1000"/>
            <Setter Property="TickFrequency" Value="500"/>
            <Setter Property="IsSnapToTickEnabled" Value="True"/>
        </Style>
        
        <Style Selector="Button.search-button">
            <Setter Property="Background" Value="#4CAF50"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="20 10"/>
            <Setter Property="CornerRadius" Value="5"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>
    </UserControl.Styles>

    <StackPanel Margin="20">
        <!-- Header -->
        <TextBlock Text="Search Location" FontSize="24" FontWeight="Bold" Margin="0 0 0 20"/>
        
        <!-- Search Input -->
        <TextBlock Text="Enter city, town, or address:" FontSize="14" Margin="0 0 0 5"/>
        <TextBox Classes="search-box" 
                 Text="{Binding SearchQuery}" 
                 Watermark="e.g., Los Angeles, CA or Idaho Falls, ID"
                 KeyDown="OnSearchKeyDown"/>
        
        <!-- Search Suggestions -->
        <ListBox Classes="suggestions" 
                 ItemsSource="{Binding SearchSuggestions}"
                 SelectedItem="{Binding SelectedSuggestion}"
                 IsVisible="{Binding HasSuggestions}">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <StackPanel Orientation="Horizontal" Margin="10 5">
                        <TextBlock Text="📍" Margin="0 0 10 0"/>
                        <StackPanel>
                            <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold"/>
                            <TextBlock Text="{Binding Description}" FontSize="12" Foreground="#666666"/>
                        </StackPanel>
                    </StackPanel>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
        
        <!-- Selected Location Display -->
        <Border Background="#E8F5E8" BorderBrush="#4CAF50" BorderThickness="1" 
                CornerRadius="5" Padding="15" Margin="0 10 0 0"
                IsVisible="{Binding HasSelectedLocation}">
            <StackPanel>
                <TextBlock Text="Selected Location:" FontWeight="Bold" Margin="0 0 0 5"/>
                <TextBlock Text="{Binding SelectedLocationName}" FontSize="16"/>
                <TextBlock Text="{Binding SelectedLocationCoordinates}" FontSize="12" Foreground="#666666"/>
            </StackPanel>
        </Border>
        
        <!-- Radius Selection -->
        <TextBlock Text="Search Radius:" FontSize="14" Margin="0 20 0 5"/>
        <Grid ColumnDefinitions="*,Auto">
            <Slider Grid.Column="0" Classes="radius-slider" 
                    Value="{Binding SearchRadiusMeters}"
                    Margin="0 0 10 0"/>
            <TextBlock Grid.Column="1" 
                       Text="{Binding SearchRadiusDisplay}" 
                       VerticalAlignment="Center"
                       FontWeight="Bold"
                       MinWidth="80"/>
        </Grid>
        
        <!-- Radius Description -->
        <TextBlock Text="{Binding RadiusDescription}" 
                   FontSize="12" 
                   Foreground="#666666" 
                   TextWrapping="Wrap"
                   Margin="0 5 0 0"/>
        
        <!-- Search Button -->
        <Button Classes="search-button" 
                Command="{Binding SearchBuildingsCommand}"
                IsEnabled="{Binding CanSearchBuildings}"
                HorizontalAlignment="Center"
                Margin="0 20 0 0">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="🏠" Margin="0 0 10 0"/>
                <TextBlock Text="Search Buildings"/>
            </StackPanel>
        </Button>
        
        <!-- Search Progress -->
        <StackPanel IsVisible="{Binding IsSearchingBuildings}" Margin="0 20 0 0">
            <ProgressBar IsIndeterminate="True" Height="4" Margin="0 0 0 10"/>
            <TextBlock Text="{Binding SearchProgressMessage}" 
                       HorizontalAlignment="Center"
                       FontSize="14"/>
        </StackPanel>
        
        <!-- Search Results Summary -->
        <Border Background="#F0F8FF" BorderBrush="#2196F3" BorderThickness="1" 
                CornerRadius="5" Padding="15" Margin="0 20 0 0"
                IsVisible="{Binding HasSearchResults}">
            <StackPanel>
                <TextBlock Text="Search Results:" FontWeight="Bold" Margin="0 0 0 5"/>
                <TextBlock Text="{Binding SearchResultsSummary}"/>
                <TextBlock Text="{Binding DensityInfo}" 
                           FontSize="12" 
                           Foreground="#666666" 
                           Margin="0 5 0 0"/>
            </StackPanel>
        </Border>
        
        <!-- Error Display -->
        <Border Background="#FFEEEE" BorderBrush="#FF0000" BorderThickness="1" 
                CornerRadius="5" Padding="15" Margin="0 20 0 0"
                IsVisible="{Binding HasSearchError}">
            <StackPanel>
                <TextBlock Text="Search Error" FontWeight="Bold" Foreground="#CC0000"/>
                <TextBlock Text="{Binding SearchErrorMessage}" 
                           TextWrapping="Wrap" 
                           Margin="0 5 0 0"/>
                <Button Content="Try Again" 
                        Command="{Binding RetrySearchCommand}" 
                        HorizontalAlignment="Left" 
                        Margin="0 10 0 0"/>
            </StackPanel>
        </Border>
    </StackPanel>
</UserControl>